Object.defineProperty(exports, '__esModule', {
  value: true
});

var _atom = require('atom');

var _utils = require('./utils');

'use babel';

exports['default'] = {

  config: {
    expandedWidth: {
      title: 'Focused Pane Width',
      description: 'Sets the Percentage between 0 and 100 of how much the focused pane will grow',
      type: 'integer',
      'default': 94,
      minimum: 1,
      maximum: 100
    }
  },

  subscriptions: null,
  ActivePane: null,
  FollowObserver: null,
  modifiedPanes: [],

  activate: function activate(state) {
    var _this = this;

    this.subscriptions = new _atom.CompositeDisposable();

    this.subscriptions.add(atom.commands.add('atom-workspace', {
      'hey-pane:toggle-focus-of-active-pane': function heyPaneToggleFocusOfActivePane() {
        return _this.toggleFocus();
      },
      'hey-pane:toggle-follow-mode': function heyPaneToggleFollowMode() {
        return _this.followMe();
      }
    }));
  },

  deactivate: function deactivate() {
    this.subscriptions.dispose();

    if (this.FollowObserver != null) this.FollowObserver.dispose();
  },

  // Activate/deactivate follow mode
  followMe: function followMe() {
    var _this2 = this;

    if (this.FollowObserver != null) {
      this.FollowObserver.dispose();
      this.FollowObserver = null;
    } else {
      this.FollowObserver = atom.workspace.onDidStopChangingActivePaneItem(function (pane) {
        _this2.setAutoFocus();
      });
    }
  },

  setAutoFocus: function setAutoFocus() {
    if (this.ActivePane != null) {
      this.undoFocus();
    }
    this.doFocus();
  },

  // Toggle Focus of active pane
  toggleFocus: function toggleFocus() {
    if (this.ActivePane != null) {
      this.undoFocus();
    } else {
      this.doFocus();
    }
  },

  doFocus: function doFocus() {
    var _this3 = this;

    this.ActivePane = this.getActivePane();
    this.ActivePane.classList.add('hey-pane-focus');

    var expandedWidth = atom.config.get('hey-pane.expandedWidth') / 100;
    var collapsedWidth = 1 - expandedWidth;

    var recursiveSet = function recursiveSet(node) {
      if (node.parentNode.nodeName === 'ATOM-PANE-AXIS') {
        _this3.saveElementStateAndSetFlex(node, expandedWidth);
        (0, _utils.getSiblings)(node).filter(function (pane) {
          return pane.nodeName !== 'ATOM-PANE-RESIZE-HANDLE';
        }).forEach(function (pane) {
          _this3.saveElementStateAndSetFlex(pane, collapsedWidth);
        });

        if (node.parentNode.parentNode.nodeName !== 'ATOM-PANE-CONTAINER') {
          recursiveSet(node.parentNode);
        }
      }
    };

    recursiveSet(this.ActivePane);
  },

  undoFocus: function undoFocus() {
    this.ActivePane.classList.remove('hey-pane-focus');
    this.ActivePane = null;
    this.restorePanes();
    this.emptyPaneStates();
  },

  saveElementStateAndSetFlex: function saveElementStateAndSetFlex(el, newFlexValue) {
    var oldFlexValue = el.style.flexGrow;
    this.modifiedPanes.push({ el: el, oldFlexValue: oldFlexValue });
    el.style.flexGrow = newFlexValue;
  },

  restorePanes: function restorePanes() {
    var Container = this.getPanesContainer();
    this.modifiedPanes.forEach(function (pane) {
      if (Container.contains(pane.el)) {
        pane.el.style.flexGrow = pane.oldFlexValue;
      }
    });
  },

  emptyPaneStates: function emptyPaneStates() {
    this.modifiedPanes = [];
  },

  getPanesContainer: function getPanesContainer() {
    var View = atom.views.getView(atom.workspace);
    return View.querySelector('.panes');
  },

  getActivePane: function getActivePane() {
    var View = atom.views.getView(atom.workspace);
    return View.querySelector('.pane.active');
  }

};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYWVsZW4vLmF0b20vcGFja2FnZXMvaGV5LXBhbmUvbGliL2hleS1wYW5lLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7b0JBRW9DLE1BQU07O3FCQUNkLFNBQVM7O0FBSHJDLFdBQVcsQ0FBQTs7cUJBS0k7O0FBRWIsUUFBTSxFQUFFO0FBQ04saUJBQWEsRUFBRTtBQUNiLFdBQUssRUFBRSxvQkFBb0I7QUFDM0IsaUJBQVcsRUFBRSw4RUFBOEU7QUFDM0YsVUFBSSxFQUFFLFNBQVM7QUFDZixpQkFBUyxFQUFFO0FBQ1gsYUFBTyxFQUFFLENBQUM7QUFDVixhQUFPLEVBQUUsR0FBRztLQUNiO0dBQ0Y7O0FBRUQsZUFBYSxFQUFFLElBQUk7QUFDbkIsWUFBVSxFQUFFLElBQUk7QUFDaEIsZ0JBQWMsRUFBRSxJQUFJO0FBQ3BCLGVBQWEsRUFBRSxFQUFFOztBQUVqQixVQUFRLEVBQUEsa0JBQUMsS0FBSyxFQUFFOzs7QUFDZCxRQUFJLENBQUMsYUFBYSxHQUFHLCtCQUF5QixDQUFBOztBQUU5QyxRQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRTtBQUN6RCw0Q0FBc0MsRUFBRTtlQUFNLE1BQUssV0FBVyxFQUFFO09BQUE7QUFDaEUsbUNBQTZCLEVBQUU7ZUFBTSxNQUFLLFFBQVEsRUFBRTtPQUFBO0tBQ3JELENBQUMsQ0FBQyxDQUFBO0dBQ0o7O0FBRUQsWUFBVSxFQUFBLHNCQUFHO0FBQ1gsUUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTs7QUFFNUIsUUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksRUFDN0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtHQUNoQzs7O0FBR0QsVUFBUSxFQUFBLG9CQUFHOzs7QUFDVCxRQUFJLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxFQUFFO0FBQy9CLFVBQUksQ0FBQyxjQUFj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QUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUMvQixZQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQTtPQUMzQztLQUNGLENBQUMsQ0FBQTtHQUNIOztBQUVELGlCQUFlLEVBQUEsMkJBQUc7QUFDaEIsUUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUE7R0FDeEI7O0FBRUQsbUJBQWlCLEVBQUEsNkJBQUc7QUFDbEIsUUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2hELFdBQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztHQUNyQzs7QUFFRCxlQUFhLEVBQUEseUJBQUc7QUFDZCxRQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDaEQsV0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0dBQzNDOztDQUVGIiwiZmlsZSI6Ii9Vc2Vycy9nYWVsZW4vLmF0b20vcGFja2FnZXMvaGV5LXBhbmUvbGliL2hleS1wYW5lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcblxuaW1wb3J0IHsgQ29tcG9zaXRlRGlzcG9zYWJsZSB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBnZXRTaWJsaW5ncyB9IGZyb20gJy4vdXRpbHMnXG5cbmV4cG9ydCBkZWZhdWx0IHtcblxuICBjb25maWc6IHtcbiAgICBleHBhbmRlZFdpZHRoOiB7XG4gICAgICB0aXRsZTogJ0ZvY3VzZWQgUGFuZSBXaWR0aCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NldHMgdGhlIFBlcmNlbnRhZ2UgYmV0d2VlbiAwIGFuZCAxMDAgb2YgaG93IG11Y2ggdGhlIGZvY3VzZWQgcGFuZSB3aWxsIGdyb3cnLFxuICAgICAgdHlwZTogJ2ludGVnZXInLFxuICAgICAgZGVmYXVsdDogOTQsXG4gICAgICBtaW5pbXVtOiAxLFxuICAgICAgbWF4aW11bTogMTAwXG4gICAgfVxuICB9LFxuXG4gIHN1YnNjcmlwdGlvbnM6IG51bGwsXG4gIEFjdGl2ZVBhbmU6IG51bGwsXG4gIEZvbGxvd09ic2VydmVyOiBudWxsLFxuICBtb2RpZmllZFBhbmVzOiBbXSxcblxuICBhY3RpdmF0ZShzdGF0ZSkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20td29ya3NwYWNlJywge1xuICAgICAgJ2hleS1wYW5lOnRvZ2dsZS1mb2N1cy1vZi1hY3RpdmUtcGFuZSc6ICgpID0+IHRoaXMudG9nZ2xlRm9jdXMoKSxcbiAgICAgICdoZXktcGFuZTp0b2dnbGUtZm9sbG93LW1vZGUnOiAoKSA9PiB0aGlzLmZvbGxvd01lKClcbiAgICB9KSlcbiAgfSxcblxuICBkZWFjdGl2YXRlKCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5kaXNwb3NlKClcblxuICAgIGlmICh0aGlzLkZvbGxvd09ic2VydmVyICE9IG51bGwpXG4gICAgICB0aGlzLkZvbGxvd09ic2VydmVyLmRpc3Bvc2UoKVxuICB9LFxuXG4gIC8vIEFjdGl2YXRlL2RlYWN0aXZhdGUgZm9sbG93IG1vZGVcbiAgZm9sbG93TWUoKSB7XG4gICAgaWYgKHRoaXMuRm9sbG93T2JzZXJ2ZXIgIT0gbnVsbCkge1xuICAgICAgdGhpcy5Gb2xsb3dPYnNlcnZlci5kaXNwb3NlKClcbiAgICAgIHRoaXMuRm9sbG93T2JzZXJ2ZXIgPSBudWxsXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuRm9sbG93T2JzZXJ2ZXIgPSBhdG9tLndvcmtzcGFjZS5vbkRpZFN0b3BDaGFuZ2luZ0FjdGl2ZVBhbmVJdGVtKChwYW5lKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0QXV0b0ZvY3VzKClcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIHNldEF1dG9Gb2N1cygpIHtcbiAgICBpZiAodGhpcy5BY3RpdmVQYW5lICE9IG51bGwpIHtcbiAgICAgIHRoaXMudW5kb0ZvY3VzKClcbiAgICB9XG4gICAgdGhpcy5kb0ZvY3VzKClcbiAgfSxcblxuICAvLyBUb2dnbGUgRm9jdXMgb2YgYWN0aXZlIHBhbmVcbiAgdG9nZ2xlRm9jdXMoKSB7XG4gICAgaWYgKHRoaXMuQWN0aXZlUGFuZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLnVuZG9Gb2N1cygpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZG9Gb2N1cygpXG4gICAgfVxuICB9LFxuXG4gIGRvRm9jdXMoKSB7XG4gICAgdGhpcy5BY3RpdmVQYW5lID0gdGhpcy5nZXRBY3RpdmVQYW5lKClcbiAgICB0aGlzLkFjdGl2ZVBhbmUuY2xhc3NMaXN0LmFkZCgnaGV5LXBhbmUtZm9jdXMnKVxuXG4gICAgY29uc3QgZXhwYW5kZWRXaWR0aCA9IGF0b20uY29uZmlnLmdldCgnaGV5LXBhbmUuZXhwYW5kZWRXaWR0aCcpIC8gMTAwXG4gICAgY29uc3QgY29sbGFwc2VkV2lkdGggPSAxIC0gZXhwYW5kZWRXaWR0aFxuXG4gICAgdmFyIHJlY3Vyc2l2ZVNldCA9IChub2RlKSA9PiB7XG4gICAgICBpZiAobm9kZS5wYXJlbnROb2RlLm5vZGVOYW1lID09PSAnQVRPTS1QQU5FLUFYSVMnKSB7XG4gICAgICAgIHRoaXMuc2F2ZUVsZW1lbnRTdGF0ZUFuZFNldEZsZXgobm9kZSwgZXhwYW5kZWRXaWR0aClcbiAgICAgICAgZ2V0U2libGluZ3Mobm9kZSlcbiAgICAgICAgLmZpbHRlcihwYW5lID0+IHBhbmUubm9kZU5hbWUgIT09ICdBVE9NLVBBTkUtUkVTSVpFLUhBTkRMRScpXG4gICAgICAgIC5mb3JFYWNoKHBhbmUgPT4ge1xuICAgICAgICAgIHRoaXMuc2F2ZUVsZW1lbnRTdGF0ZUFuZFNldEZsZXgocGFuZSwgY29sbGFwc2VkV2lkdGgpXG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKG5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLm5vZGVOYW1lICE9PSAnQVRPTS1QQU5FLUNPTlRBSU5FUicpIHtcbiAgICAgICAgICByZWN1cnNpdmVTZXQobm9kZS5wYXJlbnROb2RlKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVjdXJzaXZlU2V0KHRoaXMuQWN0aXZlUGFuZSk7XG4gIH0sXG5cbiAgdW5kb0ZvY3VzKCkge1xuICAgIHRoaXMuQWN0aXZlUGFuZS5jbGFzc0xpc3QucmVtb3ZlKCdoZXktcGFuZS1mb2N1cycpXG4gICAgdGhpcy5BY3RpdmVQYW5lID0gbnVsbFxuICAgIHRoaXMucmVzdG9yZVBhbmVzKClcbiAgICB0aGlzLmVtcHR5UGFuZVN0YXRlcygpXG4gIH0sXG5cbiAgc2F2ZUVsZW1lbnRTdGF0ZUFuZFNldEZsZXgoZWwsIG5ld0ZsZXhWYWx1ZSkge1xuICAgIGNvbnN0IG9sZEZsZXhWYWx1ZSA9IGVsLnN0eWxlLmZsZXhHcm93XG4gICAgdGhpcy5tb2RpZmllZFBhbmVzLnB1c2goeyBlbCwgb2xkRmxleFZhbHVlIH0pXG4gICAgZWwuc3R5bGUuZmxleEdyb3cgPSBuZXdGbGV4VmFsdWVcbiAgfSxcblxuICByZXN0b3JlUGFuZXMoKSB7XG4gICAgY29uc3QgQ29udGFpbmVyID0gdGhpcy5nZXRQYW5lc0NvbnRhaW5lcigpXG4gICAgdGhpcy5tb2RpZmllZFBhbmVzLmZvckVhY2gocGFuZSA9PiB7XG4gICAgICBpZiAoQ29udGFpbmVyLmNvbnRhaW5zKHBhbmUuZWwpKSB7XG4gICAgICAgIHBhbmUuZWwuc3R5bGUuZmxleEdyb3cgPSBwYW5lLm9sZEZsZXhWYWx1ZVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG5cbiAgZW1wdHlQYW5lU3RhdGVzKCkge1xuICAgIHRoaXMubW9kaWZpZWRQYW5lcyA9IFtdXG4gIH0sXG5cbiAgZ2V0UGFuZXNDb250YWluZXIoKSB7XG4gICAgY29uc3QgVmlldyA9IGF0b20udmlld3MuZ2V0VmlldyhhdG9tLndvcmtzcGFjZSk7XG4gICAgcmV0dXJuIFZpZXcucXVlcnlTZWxlY3RvcignLnBhbmVzJyk7XG4gIH0sXG5cbiAgZ2V0QWN0aXZlUGFuZSgpIHtcbiAgICBjb25zdCBWaWV3ID0gYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKTtcbiAgICByZXR1cm4gVmlldy5xdWVyeVNlbGVjdG9yKCcucGFuZS5hY3RpdmUnKTtcbiAgfVxuXG59O1xuIl19